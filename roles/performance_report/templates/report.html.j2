<!DOCTYPE html>
<html>
<head>
    <title>Linux Server Health Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 5px;
        }

        .generated-time {
            text-align: center;
            color: #555;
            margin-bottom: 30px;
        }

        table {
            border-collapse: collapse;
            width: 95%;
            margin: auto;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #007acc;
            color: white;
            text-transform: uppercase;
            font-size: 13px;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .ok {
            color: #28a745;
            font-weight: bold;
        }

        .warning {
            color: #ff9800;
            font-weight: bold;
        }

        .critical {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>Linux Infrastructure Monitoring Report</h1>

<p class="generated-time">
Generated at {{ ansible_facts['date_time']['iso8601'] }}
</p>

<table>
    <tr>
        <th>Hostname</th>
        <th>IP</th>
        <th>OS</th>
        <th>CPU Cores</th>
        <th>Memory Usage</th>
        <th>Disk Usage</th>
    </tr>

{% for host in groups['linux_servers'] %}
{% set data = hostvars[host]['performance_report_monitoring_result'] %}

{% set memory_percent = (data.memory_used_mb / data.memory_total_mb * 100) | round(1) %}
{% set disk_used_gb = (data.disk_total_gb - data.disk_free_gb) | round(2) %}
{% set disk_percent = (disk_used_gb / data.disk_total_gb * 100) | round(1) %}

<tr>
    <td>{{ data.hostname }}</td>
    <td>{{ data.ip }}</td>
    <td>{{ data.os }}</td>
    <td>{{ data.cpu_cores }}</td>

    <td class="
        {% if memory_percent < 60 %}ok
        {% elif memory_percent < 80 %}warning
        {% else %}critical
        {% endif %}
    ">
        {{ data.memory_used_mb }} / {{ data.memory_total_mb }} MB
        ({{ memory_percent }}%)
    </td>

    <td class="
        {% if disk_percent < 60 %}ok
        {% elif disk_percent < 80 %}warning
        {% else %}critical
        {% endif %}
    ">
        {{ disk_used_gb }} / {{ data.disk_total_gb }} GB
        ({{ disk_percent }}%)
    </td>
</tr>

{% endfor %}

</table>

</body>
</html>
